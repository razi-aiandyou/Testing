<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMW I Hub Assistant</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        header {
            background-color: #2563eb;
            color: white;
            padding: 10px 0;
            width: 100%;
            text-align: center;
        }
        .content {
            text-align: center;
            margin: 20px;
        }
        .bmw-virtual-assistant {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #2563eb;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <header>
        <h1>Welcome to BMW I Hub Assistant</h1>
    </header>
    <div class="content">
        <p>Chat with our virtual assistant for any inquiries or support.</p>
    </div>
    <div class="bmw-virtual-assistant">
        Chat with BMW I Hub
    </div>
    <script src="https://cdn.botpress.cloud/webchat/v1/inject.js"></script>
    <script>
        window.onload = function () {
            let isChatOpen = false;
          
            // Ensure Botpress Web Chat is available
            if (window.botpressWebChat) {
                // Initialize Botpress Web Chat
                window.botpressWebChat.init({
                    composerPlaceholder: "Chat with BMW I Hub...",
                    botConversationDescription: "iHub Assistant",
                    botId: "ec56de9c-27c0-43df-af20-61357562d911",
                    hostUrl: "https://cdn.botpress.cloud/webchat/v1",
                    webhookId: "56c3648f-19dc-4587-8b9d-2f8089c1bd01",
                    messagingUrl: "https://messaging.botpress.cloud",
                    clientId: "ec56de9c-27c0-43df-af20-61357562d911",
                    hideWidget: true,
                    lazySocket: true,
                    botName: "BMW",
                    avatarUrl: "https://thilakreddy.com/chat-logo.png",
                    stylesheet: "https://thilakreddy.com/web-bot.css",
                    frontendVersion: "v1",
                    theme: "prism",
                    themeColor: "#2563eb",
                    disableAnimations: true,
                });
              
                setTimeout(function () {
                    // Your subsequent code
                    window.botpressWebChat.mergeConfig({
                        hideWidget: false,
                    });
                    document.querySelector(".bmw-virtual-assistant").style.display = "block";
                }, 5000);
                
                let userLocation = {
                    latitude: null,
                    longitude: null,
                    status: null
                };
              
                function getLocation() {
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            function (position) {
                                userLocation.latitude = position.coords.latitude;
                                userLocation.longitude = position.coords.longitude;
                                window.botpressWebChat.sendPayload({ type: 'trigger', payload: userLocation });
                            },
                            function (error) {
                                console.error("Error occurred while fetching location: ", error);
                                window.botpressWebChat.sendPayload({ type: 'trigger', payload: userLocation });
                            }
                        );
                    } else {
                        console.error("Geolocation is not supported by this browser.");
                        window.botpressWebChat.sendPayload({ type: 'trigger', payload: userLocation });
                    }
                }
              
                window.botpressWebChat.onEvent(
                    function (event) {
                        if (event.type === "UI.OPENED") {
                            document.querySelector(".bmw-virtual-assistant").style.display = "none";
                            isChatOpen = true;
                            window.botpressWebChat.setConfig({
                                hideWidget: false,
                            });
                        } else if (event.type == "UI.CLOSED") {
                            isChatOpen = false;
                            setTimeout(function () {
                                if (!isChatOpen) {
                                    document.querySelector(".bmw-virtual-assistant").style.display = "block";
                                }
                            }, 2000);
                        } else if (event.type === "TRIGGER") {
                            if (event.value.askLocation) {
                                getLocation();
                            }
                        }
                    },
                    ["UI.OPENED", "UI.CLOSED", "TRIGGER"]
                );
            } else {
                console.error("Botpress Web Chat script not loaded.");
            }
        };
    </script>
</body>
</html>
